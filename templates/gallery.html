{% extends "layout.html" %}
{% from "macros/nav-menu.html" import  render_menu with context %}
{% block title %}{{ this.title }}{% endblock %}

{% block extra_head %}

<script src="{{ '/static/js/imgPreload.js'|url }}"></script>

{% endblock %}

{% block nav %}
{{ render_menu() }}
{% endblock %}




{% block body %}

{% from "macros/pagination.html" import render_pagination %}

<a href="{{ '/gallery'|url }}" class="uk-float-right"><button class="uk-button uk-button-primary">Back to gallery</button></a>
<h2>{{ this.name }}</h2>
<div> 
{{ this.body }}
</div>
{% if this.pagination.pages > 1 %}
  {{ render_pagination(this.pagination) }}
{% endif %}

{% set images = this.pagination.items %}
{% if images %}

<!-- image list -->
<div id="lightbox" class="uk-child-width-1-2@s uk-child-width-1-3@m uk-child-width-1-4@l uk-text-center"  uk-grid-parallax="translate:200" > 
<!-- uk-lightbox -->
  {% for image in images %}
  <div> 
    <a id="{{image._id}}" class="figure uk-inline uk-panel uk-link-muted uk-text-center" href="{{ image|url }}">
      {# {% if image.caption -%} caption="{{ image.caption }}"{%- endif %} #}
      <figure>
        <img src="{{ image.thumbnail(400)|url }}" width="400" alt="">
        {% if image.caption %}
        <figcaption class="uk-margin-small-top">{{ image.caption }}</figcaption>
        {% endif %}
      </figure>
    </a>
  </div>
  {% endfor %}

</div>

{% if this.pagination.pages > 1 %}
  {{ render_pagination(this.pagination) }}
{% endif %}

<script type="text/javascript">

{% set all_images = this.attachments.images.all() %}
  //<![CDATA[
  /*
  var img_json = [
    {%- for image in images %}
    {
    {%- set caption = image.caption|trim -%}
    {%- set description = image.description|trim -%}
    "id": "{{ image._id }}",
    "src": "{{ image|url }}",
    "width": {{ image.width }},
    "height": {{ image.height }}
    {%- if description %},
    "description": "{{ description }}"{% endif %}
    {%- if caption %},
    'caption': '{{ caption }}'{% endif %}
    }{% if not loop.last -%} ,{% endif %}
    {% endfor %}
  ];
  */
  $(function(){
//     UIkit.lightboxPanel({
//       items: [
//         {%- for image in all_images %}
//         {source: '{{ image|url }}', caption: '{{image.caption|trim}}'}{% if not loop.last -%} ,{% endif %}
//         {%- endfor %}
//       ]
//     });
  });
  var lb = UIkit.lightboxPanel({
      items: [
        {%- for image in all_images %}
        {source: '{{ image|url }}', caption: '{{image.caption|trim}}', _id:'{{image._id}}' }{% if not loop.last -%} ,{% endif %}
        {%- endfor %}
      ]
    });
    
  $('.figure').on('click', function (e) {
    e.preventDefault();
    var index = 0;
    for (var i = 0; i < lb.items.length; i++) {
      img = lb.items[i];
      if (img._id == $(this).attr('id')) {
        index = i;
        break;
      }
    }
    lb.show(index);
  });
  //]]>
  
//   ,
//       index: $(this).attr('id')
</script>


{% endif %}

{% endblock %}
